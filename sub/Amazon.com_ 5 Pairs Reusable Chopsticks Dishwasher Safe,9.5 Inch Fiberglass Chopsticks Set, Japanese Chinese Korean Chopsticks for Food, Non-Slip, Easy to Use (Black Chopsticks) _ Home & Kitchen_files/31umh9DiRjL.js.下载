(function(d){var c=window.AmazonUIPageJS||window.P,l=c._namespace||c.attributeErrors,g=l?l("StarlingInterestGroupAssignment",""):c;g.guardFatal?g.guardFatal(d)(g,window):g.execute(function(){d(g,window)})})(function(d,c,l){d.now("StarlingIGConfiguration").execute(function(c){c||d.register("StarlingIGConfiguration",function(){function a(){return navigator.userAgent}var c=/chrome|chromium|crios/i,b=/opr\//i,e=/edg/i;return{getRoboticSessionId:function(){return"000-0000000-0000000"},getToken:function(b){switch(b){case "gamma":return"A+qAAwo/s1iDqc/hfoGSql86NR2wqWsxKIUj8+Zl/KP9ErZQwRM3HhdY1Q39N1bAueSVZZ+92xFH69iddkTxZwEAAACJeyJvcmlnaW4iOiJodHRwczovL3ByZS1wcm9kLmFtYXpvbi5jb206NDQzIiwiZmVhdHVyZSI6IlByaXZhY3lTYW5kYm94QWRzQVBJcyIsImV4cGlyeSI6MTY5NTE2Nzk5OSwiaXNTdWJkb21haW4iOnRydWUsImlzVGhpcmRQYXJ0eSI6dHJ1ZX0\x3d";
case "prod":return"A69tl2WjpmRBbEqXW1MOXcXGrvFyLn/bow90s5sv6cViJ1eGQCytat/+fYLyCa0i/5O88qtcfMU9MMRZH5RSPAcAAACEeyJvcmlnaW4iOiJodHRwczovL3d3dy5hbWF6b24uY29tOjQ0MyIsImZlYXR1cmUiOiJQcml2YWN5U2FuZGJveEFkc0FQSXMiLCJleHBpcnkiOjE2OTUxNjc5OTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"}},generateGatewayUrl:function(b){switch(b){case "beta":return"https://at-"+b+".amazon-adsystem.com";case "gamma":return"https://at-"+b+"-us-east.amazon-adsystem.com";case "prod":return"https://at-us-east.amazon-adsystem.com"}},
isChrome:function(){var h=a(),f=!1;h&&(h.match(c)&&(f=!0),h.match(b)?f=!1:h.match(e)&&(f=!1));return f},getUserAgent:a,getApnPrivacySetting:function(){if(null!==document&&null!==document.cookie){var b=document.cookie.match(/(^| )apn-privacy=([^;]+)/);if(b)return"true"===b[2]}return!1},provideToken:function(b){if(null!==document&&null!==document.head){var a=document.createElement("meta");a.httpEquiv="origin-trial";a.content=b;document.head.appendChild(a)}}}})});"use strict";d.now("StarlingAddMetric").execute(function(g){g||
d.register("StarlingAddMetric",function(){return{addMetric:function(a,f){c.ue&&c.ue.count&&c.ue.count(a,f)}}})});"use strict";d.now("StarlingLogError").execute(function(g){g||d.register("StarlingLogError",function(){return{logError:function(a){var f={logLevel:2<arguments.length&&arguments[2]!==l?arguments[2]:"ERROR",attribution:"StarlingInterestGroupAssignment",message:1<arguments.length&&arguments[1]!==l?arguments[1]:""};c.ueLogError&&c.ueLogError(a,f);return[a,f]}}})});"use strict";d.now("StarlingIGJoinHelpers").execute(function(c){c||
d.when("StarlingIGHelpers","StarlingIGConfiguration","StarlingAddMetric","StarlingLogError","StarlingUtils").register("StarlingIGJoinHelpers",function(a,c,b,e,h){function f(a,c,m){var f=0,k=0,d=[];m.forEach(function(b){d.push(new Promise(function(a,c){try{h.getNavigator().joinAdInterestGroup(b,30*h.SECONDS_PER_DAY),a(b)}catch(q){c(q)}}))});return Promise.allSettled(d).then(function(a){var c=[];a.forEach(function(b){"fulfilled"===b.status?(f+=1,c.push(b.value.name)):k+=1});b.addMetric("Starling:BrowserAddedToIG:True",
f);b.addMetric("Starling:BrowserAddedToIG:False",k);h.getCustomerId()?b.addMetric("Starling:IGAssigned:AmazonCustomer",f):(h.getSessionId(),b.addMetric("Starling:IGAssigned:AmazonGuest",f))}).catch(function(a){b.addMetric("Starling:PromiseResolverError",1);e.logError(a,"Starling:PromiseResolveError. Error resolving IGJoinPromiseArray.")})}function d(c,k){return a.listInterestGroups(c+"join/",k).then(function(a){b.addMetric("Starling:ReceivedGatewayResponse",1);return a.json()}).then(function(b){var e=
a.parseIGMetadataFromResponse(b),d=b.throttleTimeForNextRequest,m=new Date;b=[];e&&0!==e.length&&b.push(f(c,{identity:k.identity},e));d&&(e=0==d?0:Number(d)+m.getTime(),h.addToLocalStorage("timestampForNextJoinRequest",e));return Promise.all(b)}).catch(function(a){a instanceof TypeError?(b.addMetric("Starling:FailedToFetchError",1),e.logError(a,"Starling:FailedToFetchError. Error making fetch request.")):(b.addMetric("Starling:ParseGatewayResponseError",1),e.logError(a,"Starling:ParseGatewayResponseError. Error parsing IG Metadata from Gateway."))})}
return{browserSupportsAdInterestGroup:function(){return"joinAdInterestGroup"in navigator&&document.featurePolicy.allowsFeature("join-ad-interest-group")&&document.featurePolicy.allowsFeature("run-ad-auction")},joinAdInterestGroups:function(a,e){e=c.generateGatewayUrl(e)+"/interestGroups/";var f=h.lookupLocalStorage("timestampForNextJoinRequest");f=f?Number(f):0;if(0!==f&&f>(new Date).getTime())b.addMetric("Starling:ThrottledIGJoinRequests",1);else return d(e,a)},TIMESTAMP_FOR_NEXT_REQUEST_KEY:"timestampForNextJoinRequest"}})});
"use strict";d.now("StarlingInterestGroupAssign").execute(function(c){c||(d.register("StarlingInterestGroupAssign",function(){var a={init:function(c,b,e,d,g){a.config=c;a.joinHelpers=d;a.metrics=b;a.errors=e;a.utils=g;c=a.config.getRoboticSessionId();b=a.utils.getHref();a.config.isChrome()&&(b?(b=a.utils.getStage(b),e=a.config.getToken(b),a.config.provideToken(e),a.assignIG(b,c)):(a.metrics.addMetric("Starling:PageLoadError",1),a.errors.logError({message:"Starling:PageLoadError. Error retreiving url from window."})))},
assignIG:function(c,b){if(a.joinHelpers.browserSupportsAdInterestGroup()){a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:True",1);var e=a.utils.lookupLocalStorage("csm:adb");if(null!=e&&e.endsWith("yes"))a.metrics.addMetric("Starling:AdBlockEnabled:True",1);else{a.metrics.addMetric("Starling:AdBlockEnabled:False",1);e=a.utils.getSessionId();var d=a.utils.getCustomerId(),f=a.utils.getPageType(),g=a.utils.getASIN(),n=a.config.getApnPrivacySetting(),k=a.utils.getHref();b=e===b;n||b?a.metrics.addMetric("Starling:TotalPunts",
1):a.joinHelpers.joinAdInterestGroups({identity:{customerId:d,sessionId:e},pageInformation:{pageURL:k,pageType:f,asins:[g]}},c);n&&a.metrics.addMetric("Starling:UserOptedOut:True",1);b&&a.metrics.addMetric("Starling:RoboticTraffic:True",1);d?a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:AmazonCustomer",1):e?a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:AmazonGuest",1):a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:NoCustomerOrSessionId")}}else a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:False",
1)}};return a}),d.when("StarlingIGConfiguration","StarlingAddMetric","StarlingLogError","StarlingIGJoinHelpers","StarlingInterestGroupAssign","StarlingUtils","ready").execute(function(a,c,b,e,d,g){d.init(a,c,b,e,g)}))});"use strict";d.now("StarlingIGLeaveHelpers").execute(function(c){c||d.when("StarlingIGHelpers","StarlingIGConfiguration","StarlingAddMetric","StarlingLogError","StarlingUtils").register("StarlingIGLeaveHelpers",function(a,c,b,e,d){function f(c,f,g){var k=0,p=0,h=[],m=c+"left/";g.forEach(function(b){h.push(new Promise(function(a,
c){try{var e={name:b.name,owner:b.owner};d.getNavigator().leaveAdInterestGroup(e);a(e)}catch(r){c(r)}}))});return Promise.allSettled(h).then(function(c){var g=[];c.forEach(function(b){"fulfilled"===b.status?(k+=1,g.push(b.value.name)):p+=1});b.addMetric("Starling:BrowserRemovedFromIG:True",k);b.addMetric("Starling:BrowserRemovedFromIG:False",p);if(d.getCustomerId())return b.addMetric("Starling:IGRemoved:AmazonCustomer",k),f.interestGroupNames=g,a.setInterestGroups(m,f).catch(function(a){b.addMetric("Starling:SetInterestGroupsLeftError",
1);e.logError(a,"Starling:SetInterestGroupsLeftError. Error Setting Interest Groups Left.")});if(d.getSessionId())return b.addMetric("Starling:IGRemoved:AmazonGuest",k),f.interestGroupNames=g,a.setInterestGroups(m,f).catch(function(a){b.addMetric("Starling:SetInterestGroupsLeftError",1);e.logError(a,"Starling:SetInterestGroupsLeftError. Error Setting Interest Groups Left.")});b.addMetric("Starling:IGRemoved:AmazonGuest",k)}).catch(function(a){b.addMetric("Starling:PromiseResolverError",1);e.logError(a,
"Starling:PromiseResolveError. Error resolving IGLeavePromiseArray.")})}function g(c,k){var h=c+"leave/",l=JSON.parse(d.lookupLocalStorage("leaveNextToken"));l&&new Date<l.expiry?k.nextToken=l.token:delete k.nextToken;return a.listInterestGroups(h,k).then(function(a){b.addMetric("Starling:ReceivedGatewayResponse",1);return a.json()}).then(function(b){var e=a.parseIGMetadataFromResponse(b),h=b.throttleTimeForNextRequest,m=new Date,l=[];e&&0!==e.length&&l.push(f(c,{identity:k.identity},e));b.nextToken?
(d.addToLocalStorage("leaveNextToken",JSON.stringify({token:b.nextToken,expiry:m.setTime(m.getTime()+144E5)})),l.push(g(c,k))):d.removeFromLocalStorage("leaveNextToken");h&&(b=0==h?0:Number(h)+m.getTime(),d.addToLocalStorage("timestampForNextLeaveRequest",b));return Promise.all(l)}).catch(function(a){a instanceof TypeError?(b.addMetric("Starling:FailedToFetchError",1),e.logError(a,"Starling:FailedToFetchError. Error making fetch request.")):(b.addMetric("Starling:ParseGatewayResponseError",1),e.logError(a,
"Starling:ParseGatewayResponseError. Error parsing IG Metadata from Gateway."))})}return{leaveAdInterestGroups:function(a,e){e=c.generateGatewayUrl(e)+"/interestGroups/";var f=d.lookupLocalStorage("timestampForNextLeaveRequest");f=f?Number(f):0;if(0!==f&&f>(new Date).getTime())b.addMetric("Starling:ThrottledIGLeaveRequests",1);else return a.maxResults=100,g(e,a)},TIMESTAMP_FOR_NEXT_REQUEST_KEY:"timestampForNextLeaveRequest"}})});"use strict";d.now("StarlingUtils").execute(function(g){g||d.register("StarlingUtils",
function(){var a=/development|beta/,d=/pre-prod|gamma/;return{lookupLocalStorage:function(b){try{return c.localStorage.getItem(b)}catch(e){return null}},addToLocalStorage:function(b,a){try{b=String(b),a=String(a),c.localStorage.setItem(b,a)}catch(h){}},removeFromLocalStorage:function(b){try{c.localStorage.getItem(b)!==l&&c.localStorage.removeItem(b)}catch(e){}},getHref:function(){return c.location.href},getWindowOpts:function(){return c.opts},getCustomerId:function(){if(c.fwcimData)return c.fwcimData.customerId;
if(c.opts)return c.opts.customerId},getStage:function(b){return a.test(b)?"beta":d.test(b)?"gamma":"prod"},getNavigator:function(){return navigator},getSessionId:function(){if(c.ue)return c.ue.sid;if(c.opts)return c.opts.sessionId},getPageType:function(){return c.ue_pty},getASIN:function(){return c.ue_pti},SECONDS_PER_DAY:86400}})});"use strict";d.now("StarlingIGHelpers").execute(function(c){c||d.when("StarlingAddMetric","StarlingLogError").register("StarlingIGHelpers",function(a,c){return{parseIGMetadataFromResponse:function(b){if(b){if((b=
b.interestGroups)&&Array.isArray(b)&&0<b.length)return a.addMetric("Starling:AttemptedIGAdd",b.length),b;a.addMetric("Starling:GatewayReturnedIGMetadata:False",1);c.logError({message:"Starling:GatewayReturnedIGMetadata:False. IG Metadata from Gateway is empty or incorrect format."});return null}a.addMetric("Starling:NullGatewayResponseError",1);c.logError({message:"Starling:NullGatewayResponseError. Null IGMetadata response from Gateway."});return null},setInterestGroups:function(b,a){return fetch(b,
{method:"POST",body:JSON.stringify(a),credentials:"include"})},listInterestGroups:function(a,c){return fetch(a,{method:"PUT",body:JSON.stringify(c),credentials:"include"})}}})})});